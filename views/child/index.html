<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>child - index</title>
    <style type="text/css">
      body { font-size: 20px; margin: 0 2em; }
      ul { line-height: 2; }
      .nowrap { white-space: nowrap; }
    </style>
  </head>
  <body>

    <h1>child - index</h1>
    <p>
      hostname: {{hostname}}<br/>
      {{#cookie}}cookie: {{name}} => <span class="nowrap">{{value}}</span>{{/cookie}}
      {{^cookie}}no cookie{{/cookie}}
    </p>
    <p>
      API '/ping' response: <span id="api-result">no response</a>
    </p>
    <ul>
      <li><a target="_top" href="http://{{child_hostname}}:3003/child/bouncer.html?return-url={{return_url}}">user interaction in target="_top"</a></li>
      <li><a target="_blank" href="http://{{child_hostname}}:3003/child/bouncer.html?return-url={{return_url}}">user interaction in target="_blank"</a></li>
      <li><a target="_top" href="http://{{child_hostname}}:3003/api/redirect?url={{return_url}}">server redirect on target="_top"</a></li>
    </ul>

  </body>

  <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      fetch('/api/ping', { method: 'get', headers: { 'Accept': 'application/json' } })
        .then(function (response) {
          if(response.ok) { return response.json(); }
          throw new Error('Network response was not ok.');
        })
        .then(function (json) { document.querySelector('#api-result').innerHTML = json.message; })
        .catch(function (error) { console.log({message: 'error calling API', error: error }); })
        .then(function () { window.parent.postMessage({ height: document.body.scrollHeight }, "*"); });
    });
  </script>
</html>
